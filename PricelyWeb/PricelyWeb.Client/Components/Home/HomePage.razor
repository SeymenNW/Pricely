@page "/"
@using Pricely.Libraries.Shared.Models
@using PricelyWeb.Services
@using PricelyWeb.Services.PricelySettings



@rendermode InteractiveWebAssembly

@inject HttpClient httpClient
@inject IGetPriceRunnerResults _getPriceRunnerResults
@inject PricelySettings _settings

<PageTitle>Hjem</PageTitle>

<MudText Typo="Typo.h4" GutterBottom="true">Søg med Pricely</MudText>
<MudText Class="mb-8">Pricely er stadig under udvikling og der kan opstå fejl.</MudText>
<MudTextField @bind-Value="@SearchText"
              OnAdornmentClick="() => GetPrices(SearchText)"
              Label="Søg på over 3 millioner produkter..."
              Variant="Variant.Outlined"
              Adornment="Adornment.End"
              AdornmentIcon="@Icons.Material.Filled.Search"
              AdornmentColor="Color.Secondary"
              Style="border-radius: 12px;"
              Class="rounded-full" />

<br />
<br />
<br />
<br />

<MudGrid Spacing="0" Justify="Justify.SpaceAround">
    @foreach (var productResult in Results.ProductResults)
    {
        <ProductListingCard ResultProduct="@productResult" />
    }
</MudGrid>

@code {
    public PriceRunnerSearchResults Results { get; set; } = new();
    public string SearchText { get; set; }

    public async Task GetPrices(string search)
    {
        // Results = await _getPriceRunnerResults.GetProductsFromSearch(search);

        Results = await _getPriceRunnerResults.GetProductsFromSearch(search);
        StateHasChanged();
    }

    protected override async Task OnInitializedAsync()
    {

        // Results =  await _getPriceRunnerResults.GetProductsFromSearch("");
    }

}